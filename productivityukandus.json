{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",


    "description": "Chart that uses repeated layers to make multiple calls to an API",

    "width":500,
    "height":350,
    
    "title": {
      "text": "Labor Productivity (Output per Hour) for All Employed Persons",
      "subtitle":"Percent Change at Annual Rate, Quarterly, Seasonally Adjusted. US Source: FRED, UK Source: ONS",
      "subtitleFontStyle":"italic",
      "subtitleFontSize":10,
      "anchor": "start",
      "color": "black"
    },

    "encoding": {
      "x": {"field": "date3", "type": "temporal", "title": null, "axis": {"grid": false}},
      "y": {"field": "value", "type": "quantitative", "title": null, "axis": {"grid": false}},
      "color":{"field":"sourceDataset", "title":"Legend", "legend":{"orient": "top-right", "labelExpr": "datum.label == 'undefined' ? 'US' :datum.label == 'video' ? 'PRDY' : 'UK'"}}
    },

    "layer": [
      
      {"data": {
"url": "https://api.allorigins.win/raw?url=https://api.ons.gov.uk/timeseries/lzvd/dataset/prdy/data",
"format": {"type": "json", "property": "quarters"}
  },

"mark": {"type": "line", "color": "#ff0000"},
"transform": [
    {"calculate": "substring(datum.quarter,1)*3-1", "as": "quarter_n"},
    {"calculate": "join([datum.year, datum.quarter_n],['-'])", "as": "date2"},
    {"calculate": "timeParse(datum.date2, '%Y-%m')", "as": "date3"},
    {"filter": {"field": "year", "range": [2000, 2021]}}
  ],
"title": {
"text": "Output per Hour Worked Time Series",
"subtitle": "% change per annum (UK) Source: ONS",
"subtitleFontStyle": "italic",
"subtitleFontSize": 10,
"anchor": "start",
"color": "black"
  },
"encoding": {
"x": {"field": "date3", "type": "temporal", "title": null},
"y": {"field": "value", "type": "quantitative", "title": null}
  }
      },

{"data": {"url": "https://raw.githubusercontent.com/lanibrown/lanibrown.github.io/main/observations.json",
       "format": {"type": "json", "property": "observations"}
  },
    "transform": [{
    "filter": {"field": "date", "range": [946684800000, 1617235200000]}
      }],

      "title": {
    "text": "Nonfarm Business Sector: Labor Productivity (Output per Hour) for All Employed Persons",
    "subtitle": "Percent Change at Annual Rate, Quarterly, Seasonally Adjusted. Source: FRED",
    "subtitleFontStyle":"italic",
    "subtitleFontSize":10,
    "anchor": "start",
    "color": "black"
  },
"mark": {"type": "line", "color": "#001aff"},
  "encoding": {
    "x": {"field": "date", "type": "temporal", "title":"Date","scale": {"domain": [946684800000, 1617235200000]}},
    "y": {"field": "value", "type": "quantitative","scale": {"domain": [-10,15]},"title":"Output per Hour"}
  }
      }
    ]
}
